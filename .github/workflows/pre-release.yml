name: pre release

# プッシュでトリガー
#on: push

on:
  # プッシュでワークフローを起動する
  # ただしreleaseブランチに対してのみ
  push:
    branches:
      - 'release/**'
      - 'hotfix/**'

jobs:
  createPullRequest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Get organization name
        run: |
          ORGANIZATION=$(echo ${{ github.repository }} | sed -e "s/\/.*//")
          echo "ORGANIZATION = $ORGANIZATION"
          echo "::set-env name=ORGANIZATION::$(echo $ORGANIZATION)"
      - name: Create pull request title
        run: |
          TITLE=$(echo ${{ github.ref }} | sed -e "s/refs\/heads\///g" | sed -e "s/release\//Release\ /g")
          echo "TITLE = $TITLE"
          echo "::set-env name=TITLE::$(echo $TITLE)"
#      - name: Create body
#        run: |
#          BODY=$(cat .github/PULL_REQUEST_TEMPLATE.md)
#          echo "BODY = $BODY"
#          echo "::set-env name=BODY::$(echo $BODY)"
      - name: Create pull request
        env:
          BODY: "- 差分確認用"
        run: |
          curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
               -X POST "https://api.github.com/repos/${{ github.repository }}/pulls" \
               -d '{"title": "${{ env.TITLE }}", "head": "${{ env.ORGANIZATION }}:${{ github.ref }}", "base": "master" , "body":"${{ env.BODY }}" , "draft":"false"}'
      - name: Check outputs
        run: |
          echo "${{ env.TITLE }}"
          echo "${{ env.ORGANIZATION }}"
          echo "${{ env.BODY }}"

#jobs:
#  createPullRequest:
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v2
#        with:
#          fetch-depth: 0
##          ref: ${{ github.head_ref }}
#      - name: create title
#        run: |
#          TITLE=$(echo ttttttttt)
#          echo "TITLE = $TITLE"
#          echo "::set-env name=TITLE::$(echo $TITLE)"
#      - name: Create Pull Request
#        #        id: cpr
#        uses: peter-evans/create-pull-request@v2
#        with:
#          token: ${{ secrets.GITHUB_TOKEN }}
#          title: ${{ env.TITLE }}
#          body: |
#            New report
#          assignees: ${{github.actor}}
#          #          reviewers: peter-evans
#          #          team-reviewers: owners, maintainers
#          #          milestone: 1
#          #          project: Example Project
#          #          project-column: To do
#          draft: false
##          branch: release/20200412_03
#          base: master
#      #          request-to-parent: false
#      - name: Check outputs
#        run: |
#          echo "${{ github.ref }}"
#          echo "Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}"
#          echo "Pull Request Number - ${{ steps.cpr.outputs.pr_number }}"

#jobs:
#  createPullRequest:
#    name: create pull request
#    runs-on: ubuntu-latest
#    steps:
#      - uses: actions/checkout@v2
##      - name: Create report file
##        run: date +%s > report.txt
#      - name: Create Pull Request
##        id: cpr
#        uses: peter-evans/create-pull-request@v2
#        with:
#          token: ${{ secrets.GITHUB_TOKEN }}
##          commit-message: Add report file
##          committer: GitHub <noreply@github.com>
##          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
#          title: echo ${{ github.head_ref }} | sed -e "s/release\//Release\ /g"
#          body: |
#            ## 概要
#
#            * 機能追加、修正内容etc
#
#            ## 仕様書
#
#            * [仕様書URL](http://xxx)
#
#            ## 技術的変更点概要
#
#            * なにを、どう、変更したか
#            * 何のライブラリを追加したか
#            * 複雑なアルゴリズムの説明
#
#          #          labels: report, automated pr
#          assignees: $GITHUB_ACTOR
##          reviewers: peter-evans
##          team-reviewers: owners, maintainers
##          milestone: 1
##          project: Example Project
##          project-column: To do
#          draft: true
#          branch: ${{ github.head_ref }}
#          base: master
##          request-to-parent: false
##      - name: Check outputs
##        run: |
##          echo "Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}"
##          echo "Pull Request Number - ${{ steps.cpr.outputs.pr_number }}"